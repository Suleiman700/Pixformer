
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>

<div class="container">
    <button class="btn btn-success" id="myButton1">Button 1</button>
    <button class="btn btn-success" id="myButton2">Button 2</button>

    <br><br>
    <input type="text" id="myInput1" placeholder="enter text">
    <input type="text" id="myInput2" placeholder="enter text">

    <br><br>
    <select class="select2" id="mySelect">
        <option value="true">true</option>
        <option value="false">false</option>
    </select>
    <div id="logs"></div>
</div>

<script src="./init.js" type="module"></script>

<script>
    const logs = [
        {
            "eventType": "click",
            "elmParentClass": "container",
            "elmTagName": "button",
            "elmClass": "btn btn-success",
            "elmId": "myButton1",
            "timestamp": 1673975880879
        },
        {
            "eventType": "click",
            "elmParentClass": "container",
            "elmTagName": "button",
            "elmClass": "btn btn-success",
            "elmId": "myButton2",
            "timestamp": 1673975882108
        },
        {
            "eventType": "click",
            "elmParentClass": "container",
            "elmTagName": "input",
            "elmId": "myInput1",
            "timestamp": 1673975883163
        },
        {
            "eventType": "input",
            "elmParentClass": "container",
            "elmTagName": "input",
            "elmId": "myInput1",
            "timestamp": 1673975883537,
            "typedValue": "1"
        },
        {
            "eventType": "click",
            "elmParentClass": "container",
            "elmTagName": "input",
            "elmId": "myInput2",
            "timestamp": 1673975884895
        },
        {
            "eventType": "input",
            "elmParentClass": "container",
            "elmTagName": "input",
            "elmId": "myInput2",
            "timestamp": 1673975885322,
            "typedValue": "2"
        },
        {
            "eventType": "click",
            "elmParentClass": "container",
            "elmTagName": "select",
            "elmClass": "select2",
            "elmId": "mySelect",
            "timestamp": 1673975886747
        },
        {
            "eventType": "change",
            "elmParentClass": "container",
            "elmTagName": "select",
            "elmClass": "select2",
            "elmId": "mySelect",
            "timestamp": 1673975888135,
            "selectedValue": "false"
        }
    ]

    const delay = (delayInms) => {
        return new Promise(resolve => setTimeout(resolve, delayInms));
    }

    let currentLogIndex = 0;
    let previousElement;

    function playLogs() {
        // if reached the end of logs
        if (currentLogIndex >= logs.length) {
            console.log("All logs have been processed.");
            return;
        }

        // remove previous item highlight
        try { previousElement.style.outline = ''; } catch (e) {}

        // get log by progress
        const logElement = logs[currentLogIndex];

        const targetParent = []
        const targetElement = []

        // check if element parent class is set
        if ('elmParentClass' in logElement) {
            /*
                since element parent class comes in string format: 'btn btn-success'
                we need to split it by space and add . to each class name and then turn it back into string.

                this is used to target the element using querySelector
             */

            // Split the class string on space and create an array, from 'btn btn-success' to ['btn', 'btn-success']
            let parentClasses = (logElement['elmParentClass']).split(' ')

            // add a '.' before each class name, ['.btn', '.btn-success']
            parentClasses = parentClasses.map(el => '.' + el)

            // join the array of classes back to a single string and push it to targetElement, '.btn.btn-success'
            targetParent.push(parentClasses.join(''))
        }

        // check if element parent id is set
        if ('elmParentId' in logElement) {
            targetParent.push(`#${logElement['elmParentId']}`)
        }

        // check element tag name
        targetElement.push(`${logElement['elmTagName']}`)

        // check if element class is set
        if ('elmClass' in logElement) {
            /*
                since element class comes in string format: 'btn btn-success'
                we need to split it by space and add . to each class name and then turn it back into string.

                this is used to target the element using querySelector
             */

            // Split the class string on space and create an array, from 'btn btn-success' to ['btn', 'btn-success']
            let classes = (logElement['elmClass']).split(' ')

            // add a '.' before each class name, ['.btn', '.btn-success']
            classes = classes.map(el => '.' + el)

            // join the array of classes back to a single string and push it to targetElement, '.btn.btn-success'
            targetElement.push(classes.join(''))
        }

        // check if element id is set
        if ('elmId' in logElement) {
            targetElement.push(`#${logElement['elmId']}`)
        }

        // get targeted element
        const targetedElement = document.querySelector(targetParent.join('') + ' ' + targetElement.join(''))

        // store this item as previous element that will be used later
        previousElement = targetedElement

        // highlight element
        targetedElement.style.outline = 'red solid 2px';

        // write log
        console.info(`%c==========================================`, 'background: yellow; color: yellow');
        console.info(`%c[UserBehavior]`, 'background: red; color: white');
        console.info(`%cEvent: ${logElement['eventType']}`, 'background: red; color: white');


        // perform action based on element type
        if (logElement['eventType'] === 'click') {
            targetedElement[logElement['eventType']]()
        }
        else if (logElement['eventType'] === 'input') {
            // console.info(`%c[UserBehavior] input event of: ${logElement['typedValue']} on element:`, 'background: red; color: white');
            // console.info(targetedElement);
            targetedElement.value += logElement['typedValue']
        }
        else if (logElement['eventType'] === 'change') {
            console.info(`%cSet selected option to: ${logElement['selectedValue']}`, 'background: red; color: white');
            targetedElement.value = logElement['selectedValue']
        }

        console.info(`%cOn element:`, 'background: red; color: white');
        console.info(targetedElement);


        // const DELAY = await delay(1000);

        // increase progress
        currentLogIndex++;

        return 'call function again to proceed'
    }
</script>
</body>
</html>